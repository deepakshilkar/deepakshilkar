{{ if .Page.Store.Get "hasMermaid" }}
<script data-cfasync="false" 
  type="application/javascript"
  src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"
></script>
<script data-cfasync="false">
  // 'data-cfasync="false"' is required for Cloudflare Pages to work
  /*
    TODO: dynamic reload if theme changes: https://github.com/mermaid-js/mermaid/issues/1945
    For now this requires a manual page reload if theme changes, which is fine for now.
  */
  let theme = localStorage.getItem("pref-theme")
  mermaid.initialize({ 
    startOnLoad: true,
    theme:theme,
    align:'{{ if site.Params.mermaid.align }}{{ site.Params.mermaid.align }}{{ else }}center{{ end }}',
  });
</script>
{{ end }}

{{ if .Page.Store.Get "hasSequenceDiagram" }}
<script src="https://cdn.jsdelivr.net/npm/underscore@1.13.1/underscore-min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/webfontloader@1.6.28/webfontloader.js"></script>
<script src="https://cdn.jsdelivr.net/npm/js-sequence-diagram@2.0.1/dist/sequence-diagram.min.js"></script>
<link href="https://cdn.jsdelivr.net/npm/js-sequence-diagram@2.0.1/dist/sequence-diagram-min.min.css" rel="stylesheet">

<script data-cfasync="false">
  document.addEventListener("DOMContentLoaded", function() {
    var theme = localStorage.getItem("pref-theme") || 'hand';
    var elements = document.getElementsByClassName('sequence-diagram');
    for (var i = 0; i < elements.length; i++) {
      var diagram = elements[i];
      Diagram.parse(diagram.innerText).drawSVG(diagram, {theme: theme});
    }
  });
</script>
{{ end }}